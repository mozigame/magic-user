<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.magic.user.entity.AgentApply">

    <resultMap id="baseResultMap" type="com.magic.user.entity.AgentApply">
        <id column="id" jdbcType="BIGINT" property="id" />
        <result column="username" jdbcType="VARCHAR" property="username" />
        <result column="realname" jdbcType="VARCHAR" property="realname" />
        <result column="password" jdbcType="VARCHAR" property="password" />
        <result column="stock_id" jdbcType="BIGINT" property="stockId" />
        <result column="stock_name" jdbcType="VARCHAR" property="stockName" />
        <result column="bank_card_no" jdbcType="VARCHAR" property="bankCardNo" />
        <result column="telephone" jdbcType="VARCHAR" property="telephone" />
        <result column="email" jdbcType="VARCHAR" property="email" />
        <result column="status" jdbcType="TINYINT" property="status"
                typeHandler="com.magic.user.utils.EnumKeyTypeHandler"/>
        <result column="resource_url" jdbcType="VARCHAR" property="resourceUrl" />
        <result column="register_ip" jdbcType="INTEGER" property="registerIp" />
        <result column="create_time" jdbcType="BIGINT" property="createTime" />
        <result column="temp1" jdbcType="VARCHAR" property="temp1" />
        <result column="temp2" jdbcType="VARCHAR" property="temp2" />
    </resultMap>


    <sql id="Base_Column_List">
    id, username, stock_id, telephone, email, status, resource_url, register_ip, create_time,
    temp1, temp2
  </sql>

    <!-- 新增代理申请--><!--used-->
    <insert id="insert" parameterType="AgentApply">
        insert into t_agent_apply (
          username,
          stock_id,
          password,
          realname,
          telephone,
          email,
          status,
          resource_url,
          register_ip,
          create_time
          )
        values (
          #{username},
          #{stockId},
          #{password},
          #{realname},
          #{telephone},
          #{email},
          #{status,jdbcType=TINYINT,typeHandler=com.magic.user.utils.EnumKeyTypeHandler},
          #{resourceUrl},
          #{registerIp},
          #{createTime}
        )
    </insert>

    <!--代理审核信息--><!--used-->
    <select id="get" resultMap="baseResultMap">
        select
        id,
        username,
        realname,
        stock_id stockId,
        stock_name stockName,
        status status,
        resource_url resourceUrl,
        register_ip registerIp,
        create_time createTime,
        telephone,
        email,
        bank_card_no bankCardNo
        from t_agent_apply
        WHERE id=#{id}

    </select>

    <!--代理审核基础信息--><!--used-->
    <select id="getDetail" resultType="java.util.HashMap">
        select
        id,
        username account,
        realname,
        telephone,
        email,
        bank_card_no bankCardNo
        from t_agent_apply
        WHERE id=#{id}

    </select>

    <!--修改申请信息的状态-->
    <update id="updateStatus">
        update t_agent_apply
        SET status=#{status,}
        WHERE id=#{id}
    </update>


    <!--代理审核列表查询--><!--used-->
    <select id="findByPage" resultType="java.util.HashMap">
        select
        a.id id,
        a.stock_id stock,
        a.stock_name holderName,
        a.username account,
        a.realname realname,
        a.telephone telephone,
        a.email email,
        a.`status` status,
        a.resource_url source,
        a.register_ip registerIp,
        r.oper_user_name operUserName,
        r.create_time operaterTime
        from t_agent_apply a
        LEFT JOIN t_agent_review r ON(a.id=r.agent_apply_id)
        <![CDATA[
         WHERE a.`status` <> 1

        ]]>
        <if test="status != null ">
            and a.status=#{status}
        </if>
        <if test="account!=null ">
            and a.username=#{account}
        </if>
        limit #{offset},#{limit}
    </select>


    <select id="findCount" resultType="java.lang.Long">
        select count(id) from t_agent_review
        <![CDATA[
         WHERE `status` <> 1

        ]]>
        <if test="status != null ">
            and status=#{status}
        </if>
        <if test="account!=null ">
            and username=#{account}
        </if>
    </select>
</mapper>